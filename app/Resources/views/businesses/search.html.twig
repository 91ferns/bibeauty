{% extends 'base.html.twig' %}

{% block body %}
<style>ul.treatmentTypes{list-style-type:none;
   position: absolute;
    z-index: 99;
    left: -10px;
    top: 40px;
    background-color: #fff;
    box-shadow:none;
    background-image:none;
    text-shadow:none;
  }
    .select2-container .select2-selection--single .select2-selection__rendered{padding-top:2px;}
    .TreatmentTypesGroup .select2-container--classic .select2-selection--single{    position: relative;z-index: 2;float: left;  width: 100%; margin-bottom: 0;height: 34px;
    padding: 0px 4px 2px;width:354px;border-radius:0;    border: 1px solid #ccc;    background-color: #fff;
        box-shadow:none;
        background-image:none;
        text-shadow:none; }
        .select2-container--classic .select2-selection--single .select2-selection__rendered{color:#999!important;}
    .TreatmentTypesGroup .select2-container--classic .select2-selection--single .select2-selection__arrow{top:-1px; width:41px;    height: 34px;}
    .TreatmentTypesGroup .select2-container--classic .select2-selection--single .select2-selection__arrow .input-group-addon{height:34px;}
    .select2-container--classic.select2-container--open .select2-dropdown {width:354px!important;}
    ul.select2-results__options > li:first-child{display:none;}
    </style>
<div class="componentBody">
  <section id="top-map" class="nav-pad">
    <div id="results-map-wrapper"></div>
  </section>
  <section id="below-map">
    <div class="container">
      <div class="row">

        <div class="col-md-4">
          <div class="search-form-sidebar">
            {{form_start(form)}}
              <div class="form-group">
                <label for="">Availability</label>
                <div class="input-group">
                  <input type="text" id="DayField" name="day" class="form-control" placeholder="Day" value="{{params['day'] | date("m/d/Y") }}" />
                  <span class="input-group-addon"><i class="fa fa-chevron-circle-down fa-lg"></i></span>
                </div>
                <div class="select2-wrapper">
                  <select multiple="true" class="form-control select2" name="Times[]">
                  {% for hour in 7..21 %}
                    {% for minute in 0..3 %}
                      {% set formattedMinute = "%02d"|format(minute * 15) %}
                      <option value="{{hour}}:{{formattedMinute}}">{{hour | nicehour }}:{{formattedMinute}} {{ hour | meridian }}</option>
                    {% endfor %}
                  {% endfor %}
                  </select>
                </div>
              </div> <!-- /.form-group -->

              <hr class="fullwidth">

              <div class="form-group">
                {{ form_label(form.location)}}
                {{ form_widget(form.location, { placeholder: 'Enter Zip code', id: 'LocationField' })}}
                {{ form_errors(form.location) }}
              </div> <!-- /.form-group -->

              <hr class="fullwidth">

              <div class="form-group">
                <label for="">Treatment Type / Category</label>
                <div class="input-group TreatmentTypesGroup">
                  <select class="treatmentTypes" name="treatment">
                    <option style="color: #999;">Select a Treatment</option>
                    {% for category in categories %}
                    <optgroup label="{{category.getLabel}}">
                    {% for subcategory in category.getChildren %}
                      <option value="{{subcategory.id }}">{{subcategory.getLabel}}</i>
                    {% endfor %}
                    </optgroup>
                    {% endfor %}
                  </select>
                  </ul>
                  <input type="hidden" name="TreatmentTypeId" />
                </div>
              </div> <!-- /.form-group -->

              <hr class="fullwidth">

              <div class="form-group">
                <label for="">Price Range</label>
                <div class="range">

      	           <input type="text" id="amount_left" name="min" readonly styles="" value="{{params['min']}}" />
                   <input type="text" id="amount_right" name="max" readonly styles="" value="{{params['max']}}" />
                   <div id="slider-range"></div>
                </div>
                <!--input type="range" id="weight" min="10" value="10" max="2000" step="100"-->
              </div> <!-- /.form-group -->

              <hr class="fullwidth">
              <br>
              <button class="btn btn-lg btn-primary">Update</button>

              {# <hr class="fullwidth">

              <p class="text-muted">Didn't find a time or day that works? Let us know what you’re looking for and we’ll notify you when it become available.</p>

              <a class="btn btn-lg btn-primary" href="#">Notify</a> #}
              {{ form_widget(form._token) }}

            {{ form_end(form, {'render_rest': false}) }}
          </div> <!-- /.search-form-sidebar -->

        </div> <!-- /.col-md-4 -->

        <div class="col-md-8">

          {% if results | length > 0 %}
            {% for business in results %}
              <hr>
              <div class="business">
                <div class="row">
                  <div class="col-md-7 ">


                    <h3>{{business.getName}}
                      {% if business.getDistanceFrom %}
                      <span class="badge">{{business.getDistanceFrom | round(1, 'floor')}} miles </span>
                      {% endif %}
                    </h3>
                    <span class="stars">
                      {{ business.getAverageRating | rating }}
                      from Yelp&trade;
                    </span> <!-- /.stars -->
                    <a class="map-icon" target="_blank" href="{{business.getAddress.getGoogleMapsUrl}}"><i class="fa fa-map-marker fa-lg"></i> Show on Map</a>
                    <div class="address">{{business.getAddress.getStreet}}, {{business.getAddress.getCity}}</div>
                    <p class="business-description">{{business.getDescription}}</p>
                  </div>
                  <div class="col-md-5">
                    {% if business.hasHeaderAttachment %}
                      <img src="{{ business.getHeaderAttachment.getKey | s3 }}" class="img-responsive pull-right" width="240" alt="{{ business.getName }}">
                    {% else %}
                      <img src="{{ asset('assets/images/placeholder-image1.png') }}" width="240" height="135" class="pull-right">
                    {% endif %}

                  </div>

                </div> <!-- /.row -->

                {% if business.getTreatments | length > 0 %}
                <ul class="list-group">
                  {% for treatment in business.getTreatments %}
                  <li class="list-group-item">
                    <h4 class="panel-title clearfix">
                      <big>{{ treatment.getLabel }}</big>
                      <a class="btn btn-primary pull-right"
                      href="{{ path('business_book_path', {
                        id: business.getId,
                        slug: business.getSlug,
                        treatment: treatment.getId })
                      }}">
                        From
                        <strong>${{ treatment.getCheapestDiscountPrice | number_format(2) }}</strong>
                      </a>
                      <span class="save pull-right">
                        Save <blue>{{ treatment.getCheapestDiscountPercentage }}%</blue>
                      </span>
                    </h4>
                  </li> <!-- .list-item-group -->
                  {% endfor %}

                </ul> <!-- /.list-group -->

              {% endif %}

              </div>
            {% endfor %}
          {% else %}
            <p>There are no results</p>
          {% endif %}

        </div> <!-- /.col-md-8 -->

      </div>

    </div> <!-- /.container -->
  </section> <!-- /#below-map -->
</div>

{% endblock body %}
{% block javascripts %}
<script>
  jQuery(document).ready(function(){
  /*  jQuery('.TreatmentTypesGroup > input, .TreatmentTypesGroup>span ').on('click',function(){
      var $list = jQuery('.treatmentTypes');
      var $grp  = jQuery(this).parent();
      var isActive = $grp.hasClass('active');

      if(isActive){
        $list.hide();
        $grp.removeClass('active');
      }else{
        $list.show();
        $grp.addClass('active');
      }
    });
    jQuery('.treatmentTypes option').on('click',function(){
      jQuery('.TreatmentTypesGroup > input').val(jQuery(this).text());
      var $list = jQuery('ul.treatmentTypes');
      var $grp  = jQuery(this).parent();
      $list.hide();
      $grp.removeClass('active');
      jQuery("[name=TreatmentTypeId]").val(jQuery(this).data('id'));
    })*/
    $(".treatmentTypes").select2({
      placeholder: "Treatments",
      //allowClear: true,
       theme: "classic"
    });
    $('b[role="presentation"]').hide();
    $('.select2-selection__arrow').append('<span class="input-group-addon"><i class="fa fa-chevron-circle-down fa-lg"></i></span>');

  });
</script>
<link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" rel="stylesheet" />
<script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>
{% endblock %}
