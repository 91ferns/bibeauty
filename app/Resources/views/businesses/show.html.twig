{% extends 'base.html.twig' %}

{% block body %}

<section id="business-information" class="nav-pad">

    {% include 'shared/businessheader.html.twig' %}

    <div class="business-main-content">
      <div class="container">
        <div class="business-description">
          <div class="row">
            <div class="col-md-8">
                <h2 class="business-name business-welcome">Welcome to {{business.getName}}</h2>
                <p class="business-description">{{business.getDescription}}</p>
                <hr>
              </div> <!-- /.business-description -->

          </div> <!-- /.row -->
        </div>  <!-- /.business-description -->

        <div class="business-services">
          <h4>Services</h4>
          {% if business.getServiceCategories.count > 0 %}
          <div class="panel-group" id="service-accordion" role="tablist" aria-multiselectable="false">

            {% for serviceCategory in business.getServiceCategories %}
            <div class="panel panel-default">
              <div class="panel-heading" role="tab"
                id="service-{{ serviceCategory.getSlug }}">
                <h4 class="panel-title">
                  <a role="button"
                    data-toggle="collapse"
                    aria-controls="service-content-{{ serviceCategory.getSlug }}"
                    data-parent="#service-accordion"
                    href="#service-content-{{ serviceCategory.getSlug }}"
                    aria-expanded="true">
                      <img src="{{ asset('assets/images/discount-tag.png')}}">
                      <big>{{ serviceCategory.getLabel }}</big>
                      {% if serviceCategory.getServices.count > 1 %}
                      <small>See all {{ serviceCategory.getServices.count }} offers <i class="fa fa-chevron-down"></i></small>
                      {% endif %}
                      <span class="pull-right">
                        from
                        <strong>${{ serviceCategory.getLowestPrice | number_format(2) }}</strong>
                      </strong>
                  </a>
                </h4>
              </div>
              <div id="service-content-{{ serviceCategory.getSlug }}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="service-{{ serviceCategory.getSlug }}">
                <div class="panel-body">
                  {# This is where the individual services go, as their own accordions #}
                  <ul class="list-group">
                  {% for service in serviceCategory.getServices %}
                    <li class="list-group-item clearfix">
                      <span class="service-name">
                        {{ service.getLabel }}
                      </span>
                      <span class="service-time">
                        {{ service.getTimeForPrint }}
                      </span>
                      <div class="pull-right">
                        <button class="btn btn-default service-old-price" disabled>
                          ${{ service.getOriginalPrice | number_format(2) }}
                        </button>
                        <a class="btn btn-primary" data-toggle="modal" href="#treatmentModal" data-whatever="@getbootstrap" data-treatment-id="{{ service.getId }}" data-business-id="{{ business.getId }}">
                          ${{ service.getCurrentPrice | number_format(2) }}
                        </a>
                      </div>
                    </li>
                  {% endfor %}
                  </ul>
                  {# end services #}
                </div>
              </div>
            </div> <!-- .panel-default -->
            {% endfor %}

          </div> <!-- /.panel-group -->

          <p class="services-notify-me">
            Didn't find a time or day that works? Let us know what you’re looking for and we’ll notify you when it become available.
          </p>

          <p>
            <a class="btn btn-primary">Notify Me</a>
          </p>

          {% else %}
            <p>There are no service categories available for this business.</p>
          {% endif %}

        </div> <!-- /.business-services -->

        <hr>

        <div class="business-reviews">
          <h4>Ratings <small><em>(written by customers after their visit)</em></small></h4>
          <div class="panel panel-default ratings-panel">
            <div class="panel-heading">
              <div class="ratings">
                <div class="row">
                  <div class="pull-left full-rating">
                    {{business.getAverageRating}}
                  </div>
                  <div class="col-sm-6">
                    <small>Chain Rating</small>
                    <div class="stars">
                      {{ business.getAverageRating | rating }} <small>from Yelp</small>
                    </div>
                  </div>
                </div> <!-- /.row -->
              </div> <!-- /.ratings -->
            </div>
            <div class="panel-body">
              Advanced ratings coming soon.
            </div>
          </div> <!-- /.panel -->
          <!--hr>
            <p>Have you been here? <a class="btn btn-secondary">Write a Review</a></p>-->
          <hr>

          <div class="review-comments">
            {% for review in business.getReviews %}
            <div class="media">
              <div class="media-left media-middle">
                <img class="media-object img-circle" src="{{ review.poster.getGravatar }}" alt="{{ review.poster.getDisplayName }}">
              </div>
              <div class="media-body">
                <h4 class="media-heading">{{ review.poster.getDisplayName }}</h4>
                <div class="ratings">
                  <div class="stars">
                    {{ review.getRating | rating }}
                  </div>
                  <em>{{ review.getCreatedAt | elapsed }}</em>
                </div>
                <p class="comment-text">{{ review.getContent }}</p>
              </div>
            </div> <!-- /.media -->
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
</section>

<div class="modal fade" id="treatmentModal" tabindex="-1" role="dialog" aria-labelledby="treatmentModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="treatmentModalLabel">Choose Available Time</h4>
      </div>
      <div class="modal-body">
        <div class="form-wrapper"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary">Book</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}
